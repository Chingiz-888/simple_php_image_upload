<!DOCTYPE html>
<html lang="ru">
<head>
	<meta charset="UTF-8">
	<title>Drag & Drop Uploading</title>
	<link rel="stylesheet" href="css/custom.css">
	<script src="js/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>


</head>
<body>
	<div id="uploads"></div>
	<div class="dropzone" id="dropzone">
	     Drop files here to upload.  <br/><br/> Перетяните сюда файлы для загрузки на сервер
	 </div>
	 <br><br>
	 <div id="result"></div>

	<script>
		(function() {
			var hostname = "http://glens.me/test_images_upload/";


			var dropzone = document.getElementById('dropzone');


			//=== функция что занимается AJAX отправкой ========
			var upload = function(files) {
				var formData = new FormData(),
					xhr = new XMLHttpRequest(),
					x;

				for (x=0; x<files.length; x++) {
					formData.append('file[]', files[x]);
				}

				xhr.onload = function() {
					//console.log(this.responseText);
					var data = JSON.parse(this.responseText);
					displayResult(data);
				}

				xhr.open('post', hostname+'upload.php');
				xhr.send(formData);
			}//===================================================



            //====блок работы с drag&drop зоной =================
			dropzone.ondrop = function(e) {
				//дефольное поведение браузера на ondrop - 
				//это открыть этот дропнутый файл в новом окне
				//нам это не нужно
				e.preventDefault();
				this.className = 'dropzone';
				console.log(e.dataTransfer.files);
				//теперь скармливаем файлы на отпарвку
				upload(e.dataTransfer.files);
			}

			dropzone.ondragover = function() {
				this.className = 'dropzone dragover';
				return false; //обязательно надо вернуть false
			}                 //иначе косяк будет

			dropzone.ondragleave = function() {
				this.className = 'dropzone';
				return false; //также false возвращаем, ибо надо
			}
			//==================================================


			//====вставка результата============================
			function displayResult(data){
				var html = "";
				if(data.result == '1') {
					html += "<h3>Рисунки были успешно загружены</h3><br>";
					for(var i=0; i<data.uploaded_images.length; i++){
						//html += '<a href="' + data.uploaded_images[i].url +
						//			'"'> +  data.uploaded_images[i].name + '</a><br>';


						html += '<a href="' + data.uploaded_images[i].url + '">' + 
						         data.uploaded_images[i].name  + '</a><br>';
						alert(html);

					}	
					//html = data.uploaded_images[0].url;
				} else {
					html = "К сожалению, рисунки не были загружены<br>";
					html += data.message;
				}
				$("#result").html(html);
			}
			//===================================================


		}());	
	</script>
</body>
</html>